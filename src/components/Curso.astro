---
const iconMap = {
  "Supervisión": "eye",
  "Camión hidroelevador aislado": "truck",
  "Normativa vigente": "file-text",
  "Rescate en altura / SPDC": "life-buoy",
  "Mantenimiento 13,2–36 kV": "wrench",
  "Lavado de aislación": "droplet",
  "Corte y poda de árboles": "scissors",
  "Andamio aislado": "layers",
  "Seguridad y riesgos eléctricos": "shield-alert",
  "Trabajos próximos": "alert-triangle",
  "Trabajos en tensión": "zap",
  "Ingeniero TcT": "user-check",
  "Ingeniero HSEC": "clipboard-check",
  "Especialista TcT": "award",
  "Inspector de TcT": "search"
};

const getIconName = (enfoque: string) => iconMap[enfoque] || "zap";

const { area, tension, enfoque, resumen, modalidad, horas, codigo, id } = Astro.props;
const tituloCorto = `${area} ${tension ? '(' + tension + ')' : ''}`;
const tituloConCodigo = codigo ? `${tituloCorto} (${codigo})` : tituloCorto;
const iconName = getIconName(enfoque);
---

<div class="curso-card-wrapper relative w-full max-w-sm h-[420px] [perspective:1000px]">
  <div class="curso-card relative w-full h-full text-white transition-transform duration-700 [transform-style:preserve-3d] rounded-2xl shadow-lg" data-id={id}>

    <!-- Frente con gradiente e ícono -->
    <div class="card-front absolute inset-0 rounded-2xl overflow-hidden [backface-visibility:hidden] bg-gradient-to-br from-gray-800 via-gray-900 to-black">
      
      <!-- Patrón decorativo de fondo -->
      <div class="absolute inset-0 opacity-10">
        <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg">
          <pattern id={`pattern-${id}`} x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
            <circle cx="2" cy="2" r="1" fill="currentColor"/>
          </pattern>
          <rect width="100%" height="100%" fill={`url(#pattern-${id})`}/>
        </svg>
      </div>

      <!-- Círculos decorativos -->
      <div class="absolute -top-20 -right-20 w-60 h-60 bg-[#5372F0] rounded-full opacity-20 blur-3xl"></div>
      <div class="absolute -bottom-20 -left-20 w-60 h-60 bg-[#00E5A0] rounded-full opacity-10 blur-3xl"></div>
      
      <!-- Contenido -->
      <div class="relative h-full p-6 flex flex-col">
        
        <!-- Ícono principal -->
        <div class="flex-1 flex items-center justify-center">
          <div class="relative">
            <!-- Círculo de fondo del ícono animado -->
            <div class="absolute inset-0 bg-[#5372F0] rounded-full blur-2xl opacity-40 scale-110 animate-pulse"></div>
            
            <!-- Ícono -->
            <div class="relative bg-gradient-to-br from-[#5372F0] to-[#4361EE] rounded-full p-8 shadow-2xl hover:scale-110 transition-transform duration-300">
              {iconName === "eye" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              )}
              {iconName === "truck" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M1 3h15v13H1zM16 8h4l3 3v5h-7V8z"/>
                  <circle cx="5.5" cy="18.5" r="2.5"/>
                  <circle cx="18.5" cy="18.5" r="2.5"/>
                </svg>
              )}
              {iconName === "file-text" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <polyline points="10 9 9 9 8 9"/>
                </svg>
              )}
              {iconName === "life-buoy" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"/>
                  <circle cx="12" cy="12" r="4"/>
                  <line x1="4.93" y1="4.93" x2="9.17" y2="9.17"/>
                  <line x1="14.83" y1="14.83" x2="19.07" y2="19.07"/>
                  <line x1="14.83" y1="9.17" x2="19.07" y2="4.93"/>
                  <line x1="14.83" y1="9.17" x2="18.36" y2="5.64"/>
                  <line x1="4.93" y1="19.07" x2="9.17" y2="14.83"/>
                </svg>
              )}
              {iconName === "wrench" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                </svg>
              )}
              {iconName === "droplet" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                </svg>
              )}
              {iconName === "scissors" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <circle cx="6" cy="6" r="3"/>
                  <circle cx="6" cy="18" r="3"/>
                  <line x1="20" y1="4" x2="8.12" y2="15.88"/>
                  <line x1="14.47" y1="14.48" x2="20" y2="20"/>
                  <line x1="8.12" y1="8.12" x2="12" y2="12"/>
                </svg>
              )}
              {iconName === "layers" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                  <polyline points="2 17 12 22 22 17"/>
                  <polyline points="2 12 12 17 22 12"/>
                </svg>
              )}
              {iconName === "shield-alert" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
              )}
              {iconName === "alert-triangle" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                  <line x1="12" y1="9" x2="12" y2="13"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
              )}
              {iconName === "zap" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
              )}
              {iconName === "user-check" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="8.5" cy="7" r="4"/>
                  <polyline points="17 11 19 13 23 9"/>
                </svg>
              )}
              {iconName === "clipboard-check" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                  <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                  <polyline points="9 14 11 16 15 12"/>
                </svg>
              )}
              {iconName === "award" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <circle cx="12" cy="8" r="7"/>
                  <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
                </svg>
              )}
              {iconName === "search" && (
                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <circle cx="11" cy="11" r="8"/>
                  <path d="m21 21-4.35-4.35"/>
                </svg>
              )}
            </div>
          </div>
        </div>

        <!-- Título y badges -->
        <div class="space-y-3">
          <h3 class="text-xl font-bold text-center">{tituloCorto}</h3>
          
          <div class="flex flex-wrap justify-center gap-2">
            <span class="bg-[#5372F0] text-white text-xs font-medium px-3 py-1 rounded-full">{enfoque}</span>
            <span class="bg-white/20 text-xs font-medium px-3 py-1 rounded-full">{horas}h</span>
            <span class="bg-white/20 text-xs font-medium px-3 py-1 rounded-full">{modalidad}</span>
          </div>

          <button 
            class="btn-curso w-full mt-4 px-4 py-2.5 bg-[#5372F0] hover:bg-[#4361EE] rounded-lg text-sm font-semibold transition-all duration-300 hover:scale-105 cursor-pointer"
            data-id={id}>
            Ver detalles
          </button>
        </div>
      </div>
    </div>

    <!-- Dorso orientado a conversión -->
    <div class="card-back absolute inset-0 rounded-2xl bg-gradient-to-b from-[#0b1020] to-[#0b0f1a] p-6 shadow-2xl transform rotate-y-180 [backface-visibility:hidden]">
      <div class="h-full w-full rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-5 flex flex-col justify-between">
        
        <!-- Contenido superior -->
        <div>
          <!-- Header compacto -->
          <div class="text-center mb-3">
            <h3 class="text-base font-bold text-white">
              {tituloCorto}
            </h3>
            {codigo && (
              <p class="text-xs text-gray-400 mt-1">Código: {codigo}</p>
            )}
          </div>

          <!-- Descripción -->
          <p class="text-sm text-gray-300 leading-relaxed mb-4">
            {resumen}
          </p>

          <!-- Duración y modalidad -->
          <div class="flex items-center justify-center gap-2 py-2.5 px-3 bg-white/5 rounded-lg mb-4">
            <svg class="w-4 h-4 text-[#5372F0]" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="9"/>
              <path d="M12 7v6l4 2" stroke-linecap="round"/>
            </svg>
            <span class="text-sm font-semibold text-white">{horas} horas · {modalidad}</span>
          </div>

          <!-- Beneficios destacados -->
          <div class="space-y-2">
            <div class="flex items-center gap-2 text-xs text-gray-300">
              <svg class="w-3.5 h-3.5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>Certificación NCh 2728:2015</span>
            </div>

            <div class="flex items-center gap-2 text-xs text-gray-300">
              <svg class="w-3.5 h-3.5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>Instructores certificados</span>
            </div>

            <div class="flex items-center gap-2 text-xs text-gray-300">
              <svg class="w-3.5 h-3.5 text-green-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>Prácticas con equipos reales</span>
            </div>
          </div>
        </div>

        <!-- CTAs en la parte inferior -->
        <div class="space-y-2 mt-4">
          <button 
            class="solicitar-info-btn block w-full py-2.5 px-4 bg-gradient-to-r from-[#5372F0] to-[#4361EE] hover:from-[#4361EE] hover:to-[#3F37C9] text-white text-center text-sm font-semibold rounded-lg transition-all duration-300 hover:scale-105 shadow-lg cursor-pointer"
            data-curso={tituloConCodigo}
          >
            <a href="#contact">Solicitar información</a>
          </button>
          
          <button
            class="btn-back w-full py-2 px-4 bg-white/5 hover:bg-white/10 text-gray-300 text-center text-xs font-medium rounded-lg transition border border-white/10"
            data-id={id}
          >
            Volver
          </button>
        </div>

      </div>
    </div>

  </div>
</div>

<style>
  .curso-card {
    transform-style: preserve-3d;
  }
  .rotated {
    transform: rotateY(180deg);
  }
  .rotate-y-180 {
    transform: rotateY(180deg);
  }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 0.4;
      transform: scale(1.1);
    }
    50% {
      opacity: 0.6;
      transform: scale(1.2);
    }
  }

</style>